---
title: "An Elegant Navigation Header in 2020"
date: 2020-06-02
author: Thomas O'Neill
---

Most every developer knows the bane of underestimation. The site's navigation
mechanism may be the greatest, most easily underestimated pitfall in basic
website development.

It is, in theory, so simple, foundational. But let's say we demand the following
of our navigation:

- It must have elegant route transitions
- It must account for all viewport sizes
- The code must be reusable, readable

Proof that this recipe is food for banging your head against a wall for many
months in succession is left as an exercise for the reader. Suffice to say we've
been through this, and here we're sharing what we've ended up with.

## Tl;dr Here's the Code

You can drag the viewport narrower and click between the navigation links for
the two pages:

<iframe src="https://codesandbox.io/embed/github/mysterybear/blog-post-demos/tree/master/packages/header-3" />

Let's assess what we've got:

1. Two different active link animations
2. ...

## Here's How it Works

There are really two key patterns we use to make this happen

### Step 1: The "Root > Backdrop + Container" Pattern

Consider the structure of this component tree:

```jsx
<Root>
  <Backdrop />
  <Container>{children}</Container>
</Root>
```

This allows us the following behaviour (tap the menu to open/close):

<iframe src="https://codesandbox.io/embed/github/mysterybear/blog-post-demos/tree/master/packages/header-1" />

This is side-agnostic:

<iframe src="https://codesandbox.io/embed/github/mysterybear/blog-post-demos/tree/master/packages/header-1?module=/pages/sideways.js&initialpath=/sideways" />

Toggle menu is courtesy of
[this Framer Motion example](https://codesandbox.io/s/framer-motion-side-menu-mx2rw?module=/src/MenuToggle.tsx)

Mention positioning the elements with CSS.

Z-index stuff: the menu > the container > the backdrop > the content

Mention Framer Motion, better with x y not height width.

### Step 2: Flexible Nav, Multiple Nav's

Our `Root > Backdrop + Container` pattern, along with React state, makes it very
easy to conditionally render this for mobile and bigger.

Nav's tend to be functionally isomorphic yet aesthetically much different when
seen in their many incarnations within websites, e.g. in the mobile vs. the
desktop header vs. in the footer. So we really want flexibility.

The following gets us most of the way there, drag the viewport's width to see
the responsive changes to the header:

<iframe src="https://codesandbox.io/embed/github/mysterybear/blog-post-demos/tree/master/packages/header-2" />

Issues:

1. Mobile nav links appear before the backdrop animation progresses sufficiently
2. Close header on navigation from mobile nav
3. Active link indication

If we try thinking a step ahead specifically on point 3: we may want different
active link indication on the desktop nav vs. on the mobile nav.

So what is the same and what is different (and at what level of the component
hierarchy)?

Same:

- The data: the link path (href), the display name (label), the active state
  (true/false); at the `<Nav />` level we should know all the links; at the
  `<Link />` level we only care about `{ href, label, active }`.

Different:

- Animation (opacity on mobile, sliding underline on desktop); `<Link />` level.
- Markup, per-link (sliding underline requires conditionally rendered div
  following the link).

<!-- 5. If the viewport is widened whilst the header is open, it says open -->

There are a couple of issues. The most obvious: the mobile nav links are
displayed before the backdrop has finished animating into full view. This is
resolved by animating our links into view, we use a nice stagger animation
courtesy again of Framer Motion:

Less obvious is the open -> viewport thingy

For the mobile nav, you do want `<AnimatePresence />` OR transition the display
manually.

`<AnimatePresence />` seems to break the cascading of variants.

### Step 3: Render props ftw

(update below for having active link color and underline too)

As of time of writing, `<AnimateSharedLayout />` is in beta. This works with
`2.0.0-beta.59` but not `2.0.0-beta.73`. Furthermore, it seems to only work if
the container is flex.

<iframe src="https://codesandbox.io/embed/github/mysterybear/blog-post-demos/tree/master/packages/header-3" />

<!-- <iframe src="https://codesandbox.io/embed/github/reduxjs/redux/tree/master/examples/todomvc" /> -->

<!-- <iframe src="https://codesandbox.io/embed/github/mysterybear/blog-post-demos/tree/master/packages/header-00" /> -->

### Step 4: ?!

Solutions to open ->viewport thing?:

- MQ hook/context
- `data-open` attribute + CSS MQ's?

```css
.backdrop {
  transform: translateY(calc(-100% + theme("spacing.12"))) !important;
}
```

# Old

## Questions

### Set the scene

- What's the difference between a header and a nav?
- Should I use the same header for mobile and desktop?
- What should I include in the header?
- What makes a good header?
- How is a header/nav different in React/Gatsby?
- ~~Why do I need a header?~~

### Baby steps

- Where do I start with making a header?
- How do I link to internal pages with Gatsby?

### Styling

- How can I show which page the user is currently on?
- How do I make the menu icon transition to an X on mobile?

## Answers

- Same header for mobile and desktop? Re-use where possible!

Semantically, a header
[_"represents introductory content, typically a group of introductory or navigational aids"_](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/header).
Navigation + branding, basically. Also, to me, header implies at the TOP! For a
sidebar, use `<aside>`. `<footer>` for bottom.

The nav's purpose is
[_"purpose is to provide navigation links"_](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/nav).

This is more a question of structure, in terms of HTML and CSS. We use Gatsby
(and therefore React), however, these concepts are somewhat
language/framework-agnostic.

### Assumptions

- This is responsive, for mobile and desktop (this is a core requirement)

### Questi-questions

How can I write my header/nav such that it is as X, Y, Z as possible (re-usable,
general, works for mobile/desktop but customizable too).

It's always something in between perfect abstraction and disposable mess.

## Intro

A preparedness to re-visit first principles. Baby steps.

## Key Points

- If element is positioned (absolute, fixed, sticky), mx-auto only works if left
  and right are 0 (tailwind rule inset-x-0)
